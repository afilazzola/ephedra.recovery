---
title:
author: "cjlortie"
date: "Dec 2016"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
---
#Ephedra californica recovery
###Purpose
To explore *Ephedra californica* recovery following clipping. Year two in a long-term shrub removal experiment. Aboveground clipping. Panoche Hills Ecological Reserve. 

Removal done by A. Liczner, A. Filazzola, T. Noble, and M. Westphal. Loss of shrub effects on animals experiment separate from this survey initiated by A. Liczner and completed 2016. Eva Gruber surveyed for resprouting.

![](./EH.jpg)

[ecoblender](http://ecoblender.org)

###Data
```{r library & data, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)

data <- read_csv("data/EH.recovery.2016.csv")
data
data <- data %>% mutate(volume = ((length + width)/2)^3*3.14*(1/3)) %>% arrange(desc(resprout))

wet.weights <-read.csv("data/wet.weights.csv")
total.weight <- wet.weights %>% select(ID, total.weight)
stems <- read_csv("data/stem.analyses.csv")

```

###EDA field data & wet weight
```{r EDA, message=FALSE, warning=FALSE}
#current volume used####
#data viz
nov.2016 <- data %>% filter(date == "nov.2016") #only resurvey
nov.2016 <- left_join(nov.2016, total.weight, by = "ID")

p1 <- ggplot(nov.2016, aes(resprout, weight= volume)) + 
  geom_histogram(binwidth = 2, fill = "dodgerblue") +
  xlab("number of shoots resprouted") +
  ylab("relative weighted frequency by current volume")
ggplotly(p1)

p1.1 <- ggplot(nov.2016, aes(ID, resprout)) + 
  geom_point(aes(size = volume), color = "dodgerblue") 
ggplotly(p1.1)

nov.2016 <- nov.2016 %>% filter(resprout < 15) #filter out my post hoc classifications

p2 <- ggplot(nov.2016, aes(volume, resprout)) + 
  geom_point(color = "dodgerblue") + 
  xlab("current shrub volume") +
  ylab("number of resprouted shoots") +
  geom_smooth(method = lm)
ggplotly(p2)

p3 <- ggplot(nov.2016, aes(volume, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("current shrub volume") +
  ylab("total wet weight") +
  geom_smooth(method = lm)
ggplotly(p3)

#number of resprouted shoots predict wet weight
p4 <- ggplot(nov.2016, aes(resprout, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("resprouted shoot numbers") +
  ylab("total wet weight") +
  geom_smooth(method = lm)
ggplotly(p4)

#quick test
fit <- lm(total.weight ~ resprout, data= nov.2016)
summary(fit)

#simple main model
m1 <- glm(resprout ~ volume, data = nov.2016)
summary(m1)
anova(m1, test = "Chisq")

m1.1 <- glm(total.weight ~ volume, data = nov.2016)
summary(m1.1)
anova(m1.1, test = "Chisq")

#setup volume####
setup <- data %>% filter(date == "april.2013") %>% 
  select(ID, volume) %>% rename(setup.vol = volume)

merged.data <- left_join(nov.2016, setup)

#repeat all above worflow code
p3 <- ggplot(merged.data, aes(resprout, weight= setup.vol)) + 
  geom_histogram(binwidth = 2, fill = "dodgerblue") +
  xlab("number of shoots resprouted") +
  ylab("relative weighted frequency by setup volume")
ggplotly(p3)

p3.1 <- ggplot(merged.data, aes(total.weight, weight= setup.vol)) + 
  geom_histogram(binwidth = 1000, fill = "dodgerblue") +
  xlab("total wet weight regrowth") +
  ylab("relative weighted frequency by setup volume")
ggplotly(p3.1)


p3.2 <- ggplot(merged.data, aes(ID, resprout)) + 
  geom_point(aes(size = setup.vol), color = "dodgerblue") 
ggplotly(p3.2)

merged.data <- merged.data %>% filter(resprout < 15) #filter out my post hoc classifications

p4 <- ggplot(merged.data, aes(setup.vol, resprout)) + 
  geom_point(color = "dodgerblue") + 
  xlab("setup shrub volume") +
  ylab("number of resprouted shoots") +
  geom_smooth(method = lm)
ggplotly(p4)

p4.1 <- ggplot(merged.data, aes(setup.vol, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("setup shrub volume") +
  ylab("total wet weight regrowth") +
  geom_smooth(method = lm)
ggplotly(p4.1)

#simple model
m2 <- glm(resprout ~ setup.vol, data = merged.data)
summary(m2)
anova(m2, test = "Chisq")

m2.1 <- glm(total.weight ~ setup.vol, data = merged.data)
summary(m2)
anova(m2.1, test = "Chisq")

#Proportion regrowth by initial shrub size
merged.data <-merged.data %>% mutate(relative.regrowth = resprout/setup.vol) #calculate proportion reprouting by initial size

merged.data <-merged.data %>% mutate(relative.biomass.regrowth = total.weight/setup.vol) #calculate proportion reprouting by initial size

p5 <- ggplot(merged.data, aes(volume, relative.regrowth)) + geom_point(color = "dodgerblue") + xlab("current shrub volume") + 
  geom_smooth(method = lm) +
  ylab("regrowth weighted by initial shrub size") +
  scale_y_continuous(breaks=c(-2,-1,0,1,2))
ggplotly(p5)

p5.1 <- ggplot(merged.data, aes(volume, relative.biomass.regrowth)) + geom_point(color = "dodgerblue") + xlab("current shrub volume") + 
  geom_smooth(method = lm) +
  ylab("biomass regrowth weighted by initial shrub size") +
  scale_y_continuous(breaks=c(-2,-1,0,1,2))
ggplotly(p5.1)

m3 <- lm(merged.data$relative.regrowth ~ merged.data$volume)
summary(m3) # slope is not significantly different from 0 so no difference in proportionate regrowth
anova(m3, test = "Chisq")

m3.1 <- lm(merged.data$relative.biomass.regrowth ~ merged.data$volume)
summary(m3.1) # slope is not significantly different from 0 so no difference in proportionate regrowth
anova(m3.1, test = "Chisq")

```

###EDA stems & dry weight
```{r stem analyses and dry weight, message=FALSE, warning=FALSE}
merged.data <- left_join(merged.data, stems, by = "ID")
#Mass EDA####
#Did wet predict dry weights?
p <- ggplot(merged.data, aes(total.weight, total.dry.weight.g)) + 
  geom_point(color = "dodgerblue") + 
  xlab("total wet weight") +
  ylab("total dry weight") +
  geom_smooth(method = lm)
ggplotly(p)

fit <- lm(total.dry.weight.g ~ total.weight, data= merged.data)
summary(fit)

#Volume by dry weight
p <- ggplot(merged.data, aes(volume, total.dry.weight.g)) + 
  geom_point(color = "dodgerblue") + 
  xlab("current shrub volume") +
  ylab("total dry weight") +
  geom_smooth(method = lm)
ggplotly(p)

fit <- lm(total.dry.weight.g ~ volume, data= merged.data)
summary(fit)

#number of resprouted shoots predict dry weight
p4 <- ggplot(merged.data, aes(resprout, total.dry.weight.g)) + 
  geom_point(color = "dodgerblue") + 
  xlab("resprouted shoot numbers") +
  ylab("total dry weight") +
  geom_smooth(method = lm)
ggplotly(p4)

fit <- lm(total.dry.weight.g ~ resprout, data= merged.data)
summary(fit)

merged.data <-merged.data %>% mutate(relative.dry.biomass.regrowth = total.weight/setup.vol) #calculate proportion reprouting by initial size
library(outliers)
chisq.out.test(merged.data$relative.dry.biomass.regrowth)
merged.data <- merged.data %>% filter(relative.dry.biomass.regrowth < 1224)

p <- ggplot(merged.data, aes(volume, relative.dry.biomass.regrowth)) + geom_point(color = "dodgerblue") + xlab("current shrub volume") + 
  geom_smooth(method = lm) +
  ylab("dry biomass regrowth by initial shrub size") +
  scale_y_continuous(breaks=c(-2,-1,0,1,2))
ggplotly(p)

m <- lm(merged.data$relative.dry.biomass.regrowth ~ merged.data$volume)
summary(m) # slope is not significantly different from 0 so no difference in proportionate regrowth
anova(m, test = "Chisq")

#Morphometrics analyses####
p <- ggplot(merged.data, aes(total.singletons, total.complex.green.shoots)) + geom_point(color = "dodgerblue") +
  geom_smooth(method = lm)
  ggplotly(p)
  
  p <- ggplot(merged.data, aes(resprout, total.singletons)) + 
    geom_point(color = "dodgerblue") +
    geom_smooth(method = lm)
  ggplotly(p)
  
    p <- ggplot(merged.data, aes(volume, total.singletons)) + 
    geom_point(color = "dodgerblue") +
    geom_smooth(method = lm)
  ggplotly(p)
```

###Ephedra foundation effects
```{r foundation, message=FALSE, warning=FALSE}
#Data
#Primary
foundation <- read_csv("data/ephedra.foundation.csv")
foundation <- foundation %>% mutate(volume = ((length + width)/2)^3*3.14*(1/3))
foundation$year <- as.character(foundation$year)
foundation$site <- as.character(foundation$site)
foundation

#Effect sizes
foundation.rii <- read_csv("data/ephedra.foundation.rii.csv")
foundation.rii <- foundation.rii %>% mutate(volume = ((length + width)/2)^3*3.14*(1/3))
foundation.rii$year <- as.character(foundation.rii$year)
foundation.rii$site <- as.character(foundation.rii$site)
foundation.rii

#Viz
ggplot(foundation, aes(microsite, abundance)) + geom_boxplot() + facet_grid(~year*site)
ggplot(foundation, aes(microsite, richness)) + geom_boxplot() + facet_grid(~year*site)

ggplot(foundation.rii, aes(year, abundance)) + geom_boxplot() + facet_grid(~site)
ggplot(foundation.rii, aes(year,richness)) + geom_boxplot() + facet_grid(~site)

#Volume
ggplot(foundation, aes(volume, abundance, color = year)) + geom_point() + geom_smooth(method = "lm") + facet_grid(~site)
ggplot(foundation, aes(volume, richness, color = year)) + geom_point() + geom_smooth(method = "lm") + facet_grid(~site)

ggplot(foundation.rii, aes(volume, abundance)) + geom_point() + geom_smooth(method = "lm") + facet_grid(~site) 
ggplot(foundation.rii, aes(volume, richness)) + geom_point() + geom_smooth(method = "lm") + facet_grid(~site)

ggplot(foundation.rii, aes(abundance, fill = year, weight = volume)) + geom_histogram() + scale_fill_brewer()
ggplot(foundation.rii, aes(richness, fill = year, weight = volume)) + geom_histogram(bindwidth = 1) + scale_fill_brewer()

```

###Summary
<b> Primary trends. </b>  

1. Counting resprouted shoots is an effective and relatively accurate mechanism to estimate regrowth in *Ephedra californica* following damage.  Trends in regrowth similar between shoot number and total wet weight, and shoot number significantly and effectively predicts the mass of biomass regrowth per shrub.


2. Larger shrubs have more resprouted shoots and regrowth of biomass; however, the regrowth is not proportionately greater for increasingly larger shrubs. THIS is an important finding.  Larger shrubs do NOT have a greater capacity to proportionally recover from damage relative to smaller shrubs.

3. *Ephedra californica* can recover to some extent following damage.  However, we do not know how these recovery patterns compare to the background growth patterns of undamaged shrubs nor whether subsequent or repeated damages to this species reduces its potential capacity to recover.

4. Methodologically, wet weight is an effective measure of biomass produced (i.e. predicts dry weight effectively with little variation).



<b> Future directions. </b>  

1. Remeasure recovery in 1 and 2 years to this new clipping event.

2. Develop a means to estimate growth rate in undamaged shrubs for the next 1-2years.  
