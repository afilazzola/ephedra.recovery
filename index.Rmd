---
title:
author: "cjlortie"
date: "Dec 2016"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
---
#Ephedra californica recovery
###Purpose
To explore ephedra recovery following clipping. Year two in a long-term shrub removal experiment. Aboveground clipping. Panoche Hills Ecological Reserve. 

Removal done by A. Liczner, A. Filazzola, T. Noble, and M. Westphal. Loss of shrub effects on animals experiment separate from this survey initiated by A. Liczner and completed 2016. Eva Gruber surveyed for resprouting.

![](./EH.jpg)

[ecoblender](http://ecoblender.org)

###Data
```{r library & data, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
data <- read_csv("data/EH.recovery.2016.csv")
data
data <- data %>% mutate(volume = ((length + width)/2)^3*3.14*(1/3)) %>% arrange(desc(resprout))

wet.weights <-read.csv("data/wet.weights.csv")
total.weight <- wet.weights %>% select(ID, total.weight)

```

###EDA
```{r EDA, message=FALSE, warning=FALSE}
#current volume used####
#data viz
nov.2016 <- data %>% filter(date == "nov.2016") #only resurvey
nov.2016 <- left_join(nov.2016, total.weight, by = "ID")

p1 <- ggplot(nov.2016, aes(resprout, weight= volume)) + 
  geom_histogram(binwidth = 2, fill = "dodgerblue") +
  xlab("number of shoots resprouted") +
  ylab("relative weighted frequency by current volume")
ggplotly(p1)

p1.1 <- ggplot(nov.2016, aes(ID, resprout)) + 
  geom_point(aes(size = volume), color = "dodgerblue") 
ggplotly(p1.1)

nov.2016 <- nov.2016 %>% filter(resprout < 15) #filter out my post hoc classifications

p2 <- ggplot(nov.2016, aes(volume, resprout)) + 
  geom_point(color = "dodgerblue") + 
  xlab("current shrub volume") +
  ylab("number of resprouted shoots") +
  geom_smooth(method = lm)
ggplotly(p2)

p3 <- ggplot(nov.2016, aes(volume, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("current shrub volume") +
  ylab("total wet weight") +
  geom_smooth(method = lm)
ggplotly(p3)

#Detour, does number of resprouted shoots predict wet weight
p4 <- ggplot(nov.2016, aes(resprout, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("resprouted shoot numbers") +
  ylab("total wet weight") +
  geom_smooth(method = lm)
ggplotly(p4)

#quick test
fit <- lm(total.weight ~ resprout, data= nov.2016)
summary(fit)

#simple main model
m1 <- glm(resprout ~ volume, data = nov.2016)
summary(m1)
anova(m1, test = "Chisq")

m1.1 <- glm(total.weight ~ volume, data = nov.2016)
summary(m1.1)
anova(m1.1, test = "Chisq")

#setup volume####
setup <- data %>% filter(date == "april.2013") %>% 
  select(ID, volume) %>% rename(setup.vol = volume)

merged.data <- left_join(nov.2016, setup)

#repeat all above worflow code
p3 <- ggplot(merged.data, aes(resprout, weight= setup.vol)) + 
  geom_histogram(binwidth = 2, fill = "dodgerblue") +
  xlab("number of shoots resprouted") +
  ylab("relative weighted frequency by setup volume")
ggplotly(p3)

p3.1 <- ggplot(merged.data, aes(total.weight, weight= setup.vol)) + 
  geom_histogram(binwidth = 1000, fill = "dodgerblue") +
  xlab("total wet weight regrowth") +
  ylab("relative weighted frequency by setup volume")
ggplotly(p3.1)


p3.2 <- ggplot(merged.data, aes(ID, resprout)) + 
  geom_point(aes(size = setup.vol), color = "dodgerblue") 
ggplotly(p3.2)

merged.data <- merged.data %>% filter(resprout < 15) #filter out my post hoc classifications

p4 <- ggplot(merged.data, aes(setup.vol, resprout)) + 
  geom_point(color = "dodgerblue") + 
  xlab("setup shrub volume") +
  ylab("number of resprouted shoots") +
  geom_smooth(method = lm)
ggplotly(p4)

p4.1 <- ggplot(merged.data, aes(setup.vol, total.weight)) + 
  geom_point(color = "dodgerblue") + 
  xlab("setup shrub volume") +
  ylab("total wet weight regrowth") +
  geom_smooth(method = lm)
ggplotly(p4.1)

#simple model
m2 <- glm(resprout ~ setup.vol, data = merged.data)
summary(m2)
anova(m2, test = "Chisq")

m2.1 <- glm(total.weight ~ setup.vol, data = merged.data)
summary(m2)
anova(m2.1, test = "Chisq")

#Proportion regrowth by initial shrub size
merged.data <-merged.data %>% mutate(relative.regrowth = resprout/setup.vol) #calculate proportion reprouting by initial size

merged.data <-merged.data %>% mutate(relative.biomass.regrowth = total.weight/setup.vol) #calculate proportion reprouting by initial size

p5 <- ggplot(merged.data, aes(volume, relative.regrowth)) + geom_point(color = "dodgerblue") + xlab("current shrub volume") + 
  geom_smooth(method = lm) +
  ylab("regrowth weighted by initial shrub size") +
  scale_y_continuous(breaks=c(-2,-1,0,1,2))
ggplotly(p5)

p5.1 <- ggplot(merged.data, aes(volume, relative.biomass.regrowth)) + geom_point(color = "dodgerblue") + xlab("current shrub volume") + 
  geom_smooth(method = lm) +
  ylab("biomass regrowth weighted by initial shrub size") +
  scale_y_continuous(breaks=c(-2,-1,0,1,2))
ggplotly(p5.1)

m3 <- lm(merged.data$relative.regrowth ~ merged.data$volume)
summary(m3) # slope is not significantly different from 0 so no difference in proportionate regrowth
anova(m3, test = "Chisq")

m3.1 <- lm(merged.data$relative.biomass.regrowth ~ merged.data$volume)
summary(m3.1) # slope is not significantly different from 0 so no difference in proportionate regrowth
anova(m3.1, test = "Chisq")

```
